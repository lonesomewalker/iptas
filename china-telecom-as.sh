#!/bin/bash

# aktuell bekannte AS:
# AS4134
# AS26658

iptables -N AS_CHINA_DENY;

iptables -I INPUT -j AS_CHINA_DENY;

asarray=("132225" "132437" "132536" "132833" "133774" "133775" "133776" "134172" "134418" "134419" "134425" "135089" "136167" "136188" "136190" "136195" "138169" "138570" "138991" "139015" "139584" "139585" "139586" "139587" "139767" "140053" "140056" "140083" "140527" "140636" "140638" "140903" "141006" "141025" "141679" "141739" "141771" "141998" "142145" "142404" "142608" "146966" "147038" "148969" "148981" "149178" "149837" "149839" "149979" "150145" "150203" "151058" "151185" "151397" "151628" "151823" "17998" "25726" "36678" "4134" "44218" "44516" "4809" "4811" "4812" "4813" "4815" "4816" "4835" "49209" "55996" "58461" "58517" "58518" "58539" "58540" "58541" "58542" "58543" "59265" "63527" "63690" "63835" "63838" "64079"
 "26658")

for i in ${asarray[@]}; do

	curl -s "https://stat.ripe.net/data/ris-prefixes/data.json?list_prefixes=true&resource=$i" | jq -r '.data.prefixes.v4.originating' | sed '1d;$d;s/"//g;s/,//g;s/ //g' >> china

done

while read line; do IFS=. read a b c d <<< "${line%/*}"; echo "${a:=0}.${b:=0}.${c:=0}.${d:=0}/${line#*/}"; done < china | sort | aggregate | xargs -n1 -I% iptables -A AS_CHINA_DENY -s % -j DROP

rm china

exit 0
