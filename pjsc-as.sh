#!/bin/bash

# aktuell bekannte AS:


iptables -N AS_PJSC_DENY;

iptables -I INPUT -j AS_PJSC_DENY;

asarray=("8997" "8872" "8828" "8773" "8755" "8675" "8594" "8580" "8570" "8568" "8563" "8557" "8443" "8402" "8382" "8371" "8359" "8350" "8263" "8249" "6877" "6863" "6854" "6850" "6849" "6828" "6731" "64434" "62389" "62362" "62358" "62348" "62347" "62345" "62339" "62284" "61176" "61014" "60891" "60773" "60512" "60496" "60490" "60482" "60419" "60122" "59937" "59846" "59838" "59646" "59483" "58287" "58112" "58080" "57880" "57876" "57681" "57187" "56982" "56768" "56761" "56503" "56350" "56341" "5591" "5573" "51981" "51668" "51638" "51632" "51618" "51411" "51334" "51281" "51116" "50928" "50795" "50725" "50646" "50530" "50406" "50397" "50373" "50315" "50240" "50164" "50071" "50011" "50002" "49966" "49816" "49801" "49665" "49380" "49356" "49350" "49288" "49213" "49170" "49154" "49144" "48826" "48796" "48713" "48615" "48612" "48541" "48421" "48400" "48377" "48359" "48343" "48322" "48312" "48309" "48281" "48217" "48212" "48124" "48123" "48100" "48035" "48000" "47985" "47919" "47899" "47817" "47579" "47567" "47460" "47457" "47399" "47395" "47354" "47344" "47218" "45048" "45000" "44987" "44982" "44932" "44895" "44736" "44677" "44618" "44579" "44467" "44412" "44408" "44257" "44237" "44235" "44090" "43975" "43970" "43907" "43841" "43793" "43687" "43583" "43574" "43468" "43396" "43318" "43302" "43275" "43218" "43148" "43132" "43095" "43053" "43038" "42990" "42915" "42891" "42842" "42825" "42771" "42758" "42610" "42554" "42548" "42448" "42396" "42362" "42358" "42337" "42322" "42288" "42245" "42231" "42126" "42115" "42110" "42091" "42087" "42043" "41976" "41822" "41797" "41771" "41742" "41691" "41510" "41440" "41375" "41279" "41260" "41209" "41145" "41134" "41061" "40993" "40978" "39858" "39811" "39799" "39722" "39644" "39571" "39415" "39407" "39254" "39229" "39167" "39054" "39001" "38996" "38985" "38951" "35728" "35615" "35531" "35516" "35475" "35473" "35400" "35389" "35298" "35237" "35177" "35154" "35125" "35081" "35078" "34974" "34910" "34894" "34892" "34875" "34747" "34644" "34584" "34552" "34508" "34490" "34449" "34351" "34297" "34267" "34205" "34168" "34147" "34137" "34038" "33934" "33894" "33887" "3253" "3239" "3235" "3216" "31558" "31496" "31489" "31425" "31359" "31353" "31338" "31286" "31268" "31261" "31224" "31213" "31208" "31205" "31195" "31185" "31163" "31133" "31094" "31088" "31061" "30974" "30922" "30881" "30751" "30749" "29648" "29497" "29456" "29285" "29225" "29209" "29194" "29190" "29125" "29102" "29069" "28975" "28884" "28881" "28860" "28840" "28832" "28812" "28802" "28790" "2878" "28719" "28712" "28703" "2766" "2599" "25531" "25521" "25515" "25513" "25510" "25490" "25436" "25405" "25290" "25159" "25086" "25008" "24937" "24913" "24873" "24866" "24810" "24789" "24783" "24767" "24707" "24699" "24665" "24612" "24579" "21487" "21483" "21480" "21479" "21378" "21365" "213337" "21332" "21289" "212741" "212631" "21252" "212375" "21231" "211583" "211076" "21103" "210613" "210600" "210353" "210288" "21017" "209962" "209912" "209462" "209119" "209024" "208977" "208739" "20872" "208651" "208560" "208493" "208428" "207931" "207141" "206968" "20663" "206388" "206325" "20632" "206283" "206257" "206217" "20597" "205647" "20533" "205207" "20519" "205161" "205118" "205023" "204865" "204834" "204781" "204533" "204477" "204377" "204354" "203951" "203516" "203063" "202378" "202319" "202041" "201851" "201700" "201626" "201350" "201191" "199825" "199054" "199013" "198618" "198609" "198504" "198503" "198486" "198409" "198394" "198381" "198247" "198179" "197610" "197461" "197360" "197203" "197070" "197023" "196877" "196747" "16345" "16301" "16287" "16256" "16124" "16054" "16043" "16020" "16012" "15934" "15895" "15802" "15759" "15640" "15559" "15500" "15468" "13257" "13174" "13155" "13118" "13095" "13062" "13056" "13055" "13053" "12846" "12730" "12705" "12697" "12683" "12543" "12530" "12421" "12396" "12389" "12380" "12332" "8813" "8343" "8207" "6703" "60786" "60423" "60256" "59708" "59481" "58216" "57831" "57755" "57709" "56660" "56490" "52155" "52066" "52065" "51554" "51431" "51336" "51074" "50810" "49100" "47940" "47330" "44924" "44703" "43918" "43005" "42727" "42143" "35245" "35123" "34918" "34068" "3326" "3263" "31520" "31360" "25216" "21338" "21261" "21219" "212076" "211705" "21170" "21075" "21011" "210064" "209647" "208828" "207897" "20754" "20725" "204812" "203903" "203684" "202504" "200796" "197743" "197067" "15785" "15402" "13249" "12933" "12883" "9147" "8985" "8662" "8631" "8615" "8485" "8427" "8193" "63765" "63764" "63759" "63757" "63754" "63743" "63742" "63734" "63732" "62277" "62268" "62261" "62198" "62135" "62115" "61269" "61239" "61206" "61151" "60740" "60726" "60652" "60638" "60623" "60611" "60540" "60383" "60348" "60343" "60173" "60002" "59973" "59703" "59476" "57996" "57884" "57737" "57683" "57579" "57135" "57056" "56995" "56964" "56881" "56830" "56777" "56632" "56492" "56160" "56152" "56147" "5589" "5568" "5547" "5543" "55307" "55305" "52196" "52069" "52014" "51860" "51813" "51811" "51771" "51716" "51672" "51641" "51639" "51584" "51543" "51346" "51309" "51268" "51235" "51219" "51130" "51003" "50885" "50820" "50776" "50714" "50706" "50416" "50361" "50339" "50298" "50141" "50041" "50038" "50001" "50000" "49965" "49891" "49886" "49799" "49779" "49732" "49729" "49533" "49526" "49347" "49301" "49211" "48642" "48608" "48531" "48475" "48470" "48396" "48237" "48216" "48007" "47976" "47882" "47737" "47618" "47471" "47445" "47313" "47241" "47170" "45548" "45546" "45538" "45029" "45018" "45006" "45003" "44961" "44775" "44731" "44597" "44522" "44456" "44174" "44102" "44049" "44047" "43921" "43832" "43820" "43782" "43766" "43690" "43543" "43527" "43213" "43197" "43163" "43078" "42843" "42728" "42676" "42628" "42403" "42385" "42224" "42139" "42041" "41793" "41740" "41673" "41656" "41551" "41428" "41389" "41361" "41341" "41300" "41258" "41226" "39812" "39660" "39589" "39501" "39428" "39376" "39350" "39148" "38735" "38734" "38247" "35819" "35690" "35641" "35340" "34662" "34412" "34400" "34250" "33936" "33903" "33777" "3316" "3315" "328200" "31649" "31501" "31364" "30910" "29428" "29107" "29038" "28910" "28906" "28829" "28769" "28745" "25880" "25296" "25269" "24923" "24823" "24811" "24797" "24626" "24599" "24088" "21438" "213304" "213067" "21292" "212869" "212764" "212409" "212264" "212114" "211976" "21191" "211525" "21127" "211081" "210954" "210520" "21023" "209779" "209459" "209352" "209351" "208774" "20870" "208615" "208177" "207692" "207507" "207078" "206973" "206670" "206635" "206630" "206465" "206392" "206295" "206181" "206153" "205585" "205022" "20485" "204219" "203599" "203492" "203477" "203392" "202697" "202660" "202642" "202468" "202175" "201767" "201576" "201540" "201452" "201051" "201015" "200926" "200816" "200644" "199633" "199549" "199463" "199313" "198899" "198569" "198523" "198491" "198390" "198373" "198200" "198168" "197783" "197486" "197333" "197222" "197010" "196986" "196797" "16285" "15974" "15835" "15757" "15707" "15549" "149117" "149109" "149098" "149082" "149067" "140835" "140834" "140833" "140826" "140825" "140818" "140817" "140813" "140811" "140804" "140799" "140792" "140791" "140790" "140789" "140785" "140784" "140780" "140776" "140775" "140773" "140771" "140765" "140763" "140762" "140761" "140754" "140749" "140746" "140744" "140738" "140737" "135999" "135997" "135996" "135995" "135990" "135986" "135983" "135977" "135971" "135969" "135968" "135962" "135961" "135958" "135952" "135949" "135945" "135939" "135936" "135932" "135930" "135926" "135912" "135904" "135903" "135902" "131439" "131435" "131418" "131413" "131409" "131406" "131403" "131400" "131394" "131392" "131376" "131366" "131360" "131344" "131130" "131128" "12688")

for i in ${asarray[@]}; do

	curl -s "https://stat.ripe.net/data/ris-prefixes/data.json?list_prefixes=true&resource=$i" | jq -r '.data.prefixes.v4.originating' | sed '1d;$d;s/"//g;s/,//g;s/ //g' >> pjsc

done


while read line; do IFS=. read a b c d <<< "${line%/*}"; echo "${a:=0}.${b:=0}.${c:=0}.${d:=0}/${line#*/}"; done < pjsc | sort | aggregate | xargs -n1 -I% iptables -A AS_PJSC_DENY -s % -j DROP

rm pjsc

exit 0